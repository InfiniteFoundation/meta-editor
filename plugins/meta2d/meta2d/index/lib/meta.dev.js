"use strict";function DomLoad(){if("interactive"===document.readyState||"complete"===document.readyState)return meta.emit("domload"),void 0;var e=function(t){meta.emit("domload"),window.removeEventListener("DOMContentLoaded",e)};window.addEventListener("DOMContentLoaded",e)}var meta={version:"0.9",view:null,views:{},flags:{autoPowTwo:!0},time:{delta:0,deltaF:0,maxDelta:250,scale:1,curr:0,fps:0,current:0,update:0,accumulator:0,frameIndex:0,updateFreq:100},cache:{width:0,height:0,timerIndex:0},$listeners:{},on:function(e,t,i){var n=this.$listeners[e];n?n.push(new this.Watcher(t,i)):(n=[new this.Watcher(t,i)],this.$listeners[e]=n)},off:function(e,t,i){var n=this.$listeners[e];if(!n)return console.warn("(meta.off) No listeners found for the event: "+e),void 0;i=i||window;for(var s=n.length,r=0;s>r;r++){var o=n[r];if(o.owner===i&&o.func===t){n[r]=n[s-1],n.pop();break}}},emit:function(e,t){var i=this.$listeners[e];if(i)if(t)for(var n=0;n<i.length;n++){var s=i[n];s.func.call(s.owner,t)}else for(var n=0;n<i.length;n++){var s=i[n];s.func.call(s.owner)}},Watcher:function(e,t){this.func=e,this.owner=t||window}};"use strict",function(e){function t(e,i,n,a){for(var h=null,c=window,u=e.split("."),m=u.length-1,d=u[m],l=0;m>l;l++)h=c,c=c[u[l]],c||(c={},h[u[l]]=c);var f=o[e],v=c[d],p=function e(t,i,n,r,o,a){s||this.init&&this.init(t,i,n,r,o,a)},g=null,w=null;i?(s=!0,g=new i,w=g.__proto__,s=!1):(s=!0,g=new meta.class,s=!1);for(var E in n){var y=Object.getOwnPropertyDescriptor(n,E);y.get||y.set?Object.defineProperty(g,E,y):i&&"function"==typeof n[E]&&"function"==typeof w[E]&&r.test(n[E])?g[E]=function(e,t){return function(i,n,s,r,o,a){var h=this._super;this._super=w[e],this._fn=t;var c=this._fn(i,n,s,r,o,a);return this._super=h,c}}(E,n[E]):g[E]=n[E]}if(g.delete=function(){this.__managed__?meta.delete(this):this.remove()},g.__managed__=!1,p.prototype=g,p.prototype.__name__=e,p.prototype.__lastName__=d,p.prototype.constructor=g.init||null,c[d]=p,v)for(var E in v)p[E]=v[E];if(f){var x=null,b=f.classes;for(m=b.length,l=0;m>l;l++)x=b[l],t(x.name,p,x.prop,x.cb);delete o[e]}a&&a(p,e)}function i(){this.classes=[]}function n(e,t,i){this.name=e,this.prop=t,this.cb=i}e.meta||(e.meta={});var s=!1,r=/\b_super\b/,o={};meta.class=function(e,t,i,n){s||meta.class._construct(e,t,i,n)},meta.class._construct=function(e,s,r,a){if(!e)return console.error("(meta.class) Invalid class name"),void 0;r||(r=s,s=null),r||(r={});var h=null;if(s){for(var c=null,u=window,m=s.split("."),d=m.length-1,l=0;d>l;l++)c=u,u=u[m[l]],u||(u={},c[m[l]]=u);var f=m[d];if(h=u[f],!h){var v=o[s];return v||(v=new i,o[s]=v),v.classes.push(new n(e,r,a)),void 0}}t(e,h,r,a)},meta.classLoaded=function(){var e=0,t=null,i=null,n=0;for(var s in o)for(t=o[s],console.error("Undefined class: "+s),i=t.classes,n=i.length,e=0;n>e;e++)console.error("Undefined class: "+i[e].name);t={}}}(void 0!==typeof window?window:global),"use strict",meta.isPowerOfTwo=function(e){return 0!=e&&(e&~e+1)===e},meta.getNameFromPath=function(e){var t=e.lastIndexOf("."),i=e.lastIndexOf("/");return 0>t||e.length-t>5?e.slice(i+1):e.slice(i+1,t)},meta.getExtFromPath=function(e){var t=e.lastIndexOf(".");return-1===t?null:e.slice(t+1)},"use strict",meta.engine={init:function(){meta.emit("init"),this.parseFlags(),this.addMetaTags(),this.createWebGL(),this.print(),this.flags|=this.Flag.INITIALIZED,this.setup()},setup:function(){meta.emit("setup"),this.addListeners();var e=new meta.View("master");e.$activate(),meta.views.master=e,meta.view=e,meta.renderer.setup(),this.updateResolution(),meta.camera=new meta.Camera,this.flags|=this.Flag.SETUPED,this.preload()},preload:function(){meta.emit("preload"),this.flags|=this.Flag.PRELOADED;var e=this;this.$renderLoopFunc=function(){e.render()},this.$renderLoopFunc(),this.load()},$renderLoopFunc:null,load:function(){meta.emit("load"),this.flags|=this.Flag.LOADED},ready:function(){meta.emit("ready"),this.flags|=this.Flag.READY},update:function(e){meta.emit("update",e)},render:function(){this.time.frameIndex++;var e=Date.now();this.time.pause?(this.time.delta=0,this.time.deltaF=0):(this.time.delta=e-this.time.current,this.time.delta>this.time.maxDelta&&(this.time.delta=this.time.maxDelta),this.time.delta*=this.time.scale,this.time.deltaF=this.time.delta/1e3,this.time.accumulator+=this.time.delta),e-this.time.fps>=1e3&&(this.time.fps=e,this.fps=this.$fpsCounter,this.$fpsCounter=0,meta.emit("fps",this.fps)),this.update(this.time.deltaF),meta.emit("render"),meta.renderer.render(this.time.deltaF),this.$fpsCounter++,this.time.current=e,requestAnimationFrame(this.$renderLoopFunc)},updateResolution:function(){var e=meta.cache.width,t=meta.cache.height;this.container===document.body?(e=window.innerWidth,t=window.innerHeight):(e=this.container.clientWidth,t=this.container.clientHeight),this.width=Math.ceil(e),this.height=Math.ceil(t),this.canvas.width=this.width,this.canvas.height=this.height,this.canvas.style.width=e*this.scaleX+"px",this.canvas.style.height=t*this.scaleY+"px",meta.renderer.onResize()},$updateOffset:function(){this.offsetLeft=0,this.offsetTop=0;var e=this.container;if(e.offsetParent)do this.offsetLeft+=e.offsetLeft,this.offsetTop+=e.offsetTop;while(e=e.offsetParent);var t=this.container.getBoundingClientRect();this.offsetLeft+=t.left,this.offsetTop+=t.top,t=this.canvas.getBoundingClientRect(),this.offsetLeft+=t.left,this.offsetTop+=t.top},addMetaTags:function(){if(!(this.flags&this.Flag.META_TAGS_ADDED)){var e=document.createElement("meta");e.setAttribute("http-equiv","Content-Type"),e.setAttribute("content","text/html; charset=utf-8"),document.head.appendChild(e);var t=document.createElement("meta");t.setAttribute("http-equiv","encoding"),t.setAttribute("content","utf-8"),document.head.appendChild(t);var i="user-scalable=no, initial-scale=1, maximum-scale=1, minimum-scale=1, width=device-width, height=device-height",n=document.createElement("meta");n.setAttribute("name","viewport"),n.setAttribute("content",i),document.head.appendChild(n);var s=document.createElement("meta");s.setAttribute("name","apple-mobile-web-app-capable"),s.setAttribute("content","yes"),document.head.appendChild(s);var r=document.createElement("meta");r.setAttribute("name","apple-mobile-web-app-status-bar-style"),r.setAttribute("content","black-translucent"),document.head.appendChild(r),this.flags|=this.Flag.META_TAGS_ADDED}},parseFlags:function(){for(var flag,flagName,flagValue,flagSepIndex,flags=window.location.hash.substr(1).split(","),num=flags.length,n=0;num>n;n++)flag=flags[n],flagSepIndex=flag.indexOf("="),flagSepIndex>0&&(flagName=flag.substr(0,flagSepIndex).replace(/ /g,""),flagValue=eval(flag.substr(flagSepIndex+1).replace(/ /g,"")),meta.flags[flagName]=flagValue)},createWebGL:function(){this.canvas=document.createElement("canvas"),this.canvas.id="meta-webgl",this.canvas.style.cssText=this.canvasStyle,this.gl=WebGLDebugUtils.makeDebugContext(this.canvas.getContext("webgl")||this.canvas.getContext("experimental-webgl")),this.container||(this.container=document.body),document.body.style.cssText=this.containerStyle,this.container.appendChild(this.canvas),this.gl.enable(this.gl.DEPTH_TEST),this.gl.depthFunc(this.gl.LEQUAL)},addListeners:function(){var e=this;this.cb={resize:function(t){e.updateResolution()},focus:function(t){e.handleFocus(!0)},blur:function(t){e.handleFocus(!1)}},window.addEventListener("resize",this.cb.resize,!1),window.addEventListener("orientationchange",this.cb.resize,!1),meta.device.hidden&&(this.cb.visibilityChange=function(){e.handleVisibilityChange()},document.addEventListener(meta.device.visibilityChange,this.cb.visibilityChange)),window.addEventListener("focus",this.cb.focus),window.addEventListener("blur",this.cb.blur),meta.device.support.fullScreen&&(this.cb.fullscreen=function(){e.onFullScreenChangeCB()},document.addEventListener(meta.device.fullScreenOnChange,this.cb.fullscreen)),this.canvas.addEventListener("webglcontextlost",function(){e.onCtxLost()}),this.canvas.addEventListener("webglcontextrestored",function(){e.onCtxRestored()})},handleFocus:function(e){this.flags&this.Flat.PAUSE_ON_BLUR&&(this.pause=!e),e?meta.emit("focus"):meta.emit("blur")},handleVisibilityChange:function(){document[meta.device.hidden]?this.handleFocus(!1):this.handleFocus(!0)},onFullScreenChangeCB:function(){var e=document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement;meta.device.fullscreen=!!e,this.onFullscreen.emit(meta.device.fullscreen,meta.Event.FULLSCREEN)},onCtxLost:function(){console.log("(Context lost)")},onCtxRestored:function(){console.log("(Context restored)")},print:function(){meta.device.support.consoleCSS?(console.log("%c META2D v"+meta.version+" ","background: #000; color: white; font-size: 12px; padding: 2px 0 1px 0;","http://meta2d.com"),console.log("%cBrowser: %c"+meta.device.name+" "+meta.device.version+"	","font-weight: bold; padding: 2px 0 1px 0;","padding: 2px 0 1px 0;"),console.log("%cRenderer: %cCanvas ","font-weight: bold; padding: 2px 0 2px 0;","padding: 2px 0 2px 0;")):(console.log("META2D v"+meta.version+" http://meta2d.com "),console.log("Browser: "+meta.device.name+" "+meta.device.version+"	"),console.log("Renderer: Canvas "))},get focus(){return this.flags&this.Flag.FOCUS},Flag:{INITIALIZED:1,SETUPED:2,PRELOADED:4,LOADED:8,READY:16,META_TAGS_ADDED:32,FOCUS:64,FULLSCREEN:128},container:null,canvas:null,gl:null,flags:null,cb:null,timers:[],timersRemove:[],width:0,height:0,scaleX:1,scaleY:1,zoom:1,ratio:1,offsetLeft:0,offsetTop:0,time:meta.time,fps:0,$fpsCounter:0,containerStyle:"padding:0; margin:0;",canvasStyle:"position:absolute; width: 100%; height: 100%; overflow:hidden; translateZ(0); -webkit-backface-visibility:hidden; -webkit-perspective: 1000; -webkit-touch-callout: none; -webkit-user-select: none; zoom: 1;"},"use strict",meta.cache.exts={},meta.cache.extParams={},meta.getExt=function(e){var t=this.cache.exts[e];if(t)return t;var i=meta.engine.gl;switch(e){case"WEBGL_depth_texture":t=i.getExtension("WEBGL_depth_texture")||i.getExtension("WEBKIT_WEBGL_depth_texture")||i.getExtension("MOZ_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":t=i.getExtension("EXT_texture_filter_anisotropic")||i.getExtension("WEBKIT_EXT_texture_filter_anisotropic")||i.getExtension("MOZ_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":t=i.getExtension("WEBGL_compressed_texture_s3tc")||i.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc")||i.getExtension("MOZ_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":t=i.getExtension("WEBGL_compressed_texture_pvrtc")||i.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;case"WEBGL_compressed_texture_etc1":t=i.getExtension("WEBGL_compressed_texture_etc1");break;default:t=i.getExtension(e)}return null===t?(console.warn("(meta.getExtension) Extension not supported: "+e),void 0):(this.cache.exts[e]=t,t)},meta.getExtParam=function(e){var t=this.cache.extParams[e];return t||(t=meta.engine.gl.getParameter(e),this.cache.extParams[e]=t),t},"use strict",meta.device={load:function(){this.checkBrowser(),this.mobile=this.isMobileAgent(),this.checkConsoleCSS(),this.checkFileAPI(),this.support.onloadedmetadata="object"==typeof window.onloadedmetadata,this.support.onkeyup="object"==typeof window.onkeyup,this.support.onkeydown="object"==typeof window.onkeydown,this.support.canvas=this.isCanvasSupport(),this.support.webgl=this.isWebGLSupport(),this.modernize()},checkBrowser:function(){var e={Chrome:[/Chrome\/(\S+)/],Firefox:[/Firefox\/(\S+)/],MSIE:[/MSIE (\S+);/],Opera:[/OPR\/(\S+)/,/Opera\/.*?Version\/(\S+)/,/Opera\/(\S+)/],Safari:[/Version\/(\S+).*?Safari\//]},t=navigator.userAgent,i,n,s,r=2;for(i in e)for(;n=e[i].shift();)if(s=t.match(n)){this.version=s[1].match(new RegExp("[^.]+(?:.[^.]+){0,"+--r+"}"))[0],this.name=i,this.versionBuffer=this.version.split(".");for(var o=this.versionBuffer.length,a=0;o>a;a++)this.versionBuffer[a]=parseInt(this.versionBuffer[a]);break}null===this.versionBuffer||"unknown"===this.name?console.warn("(meta.device.checkBrowser) Could not detect browser."):"Chrome"===this.name||"Safari"===this.name||"Opera"===this.name?this.vendor="webkit":"Firefox"===this.name?this.vendor="moz":"MSIE"===this.name&&(this.vendor="ms")},checkConsoleCSS:function(){this.mobile||"Chrome"!==this.name&&"Opera"!==this.name?this.support.consoleCSS=!1:this.support.consoleCSS=!0},checkFileAPI:function(){window.File&&window.FileReader&&window.FileList&&window.Blob?this.support.fileAPI=!0:this.support.fileAPI=!1},modernize:function(){Number.MAX_SAFE_INTEGER||(Number.MAX_SAFE_INTEGER=9007199254740991),this.supportConsole(),this.supportPageVisibility(),this.supportFullScreen(),this.supportRequestAnimFrame(),this.supportPerformanceNow(),this.supportAudioFormats(),this.supportAudioAPI(),this.supportFileSystemAPI()},isMobileAgent:function(){return/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)},isCanvasSupport:function(){return!!window.CanvasRenderingContext2D},isWebGLSupport:function(){var e=document.createElement("canvas"),t=e.getContext("webgl")||e.getContext("experimental-webgl");return!!t},supportConsole:function(){window.console||(window.console={},window.console.log=meta.emptyFuncParam,window.console.warn=meta.emptyFuncParam,window.console.error=meta.emptyFuncParam)},supportPageVisibility:function(){void 0!==document.hidden?(this.hidden="hidden",this.visibilityChange="visibilitychange"):void 0!==document.hidden?(this.hidden="webkitHidden",this.visibilityChange="webkitvisibilitychange"):void 0!==document.hidden?(this.hidden="mozhidden",this.visibilityChange="mozvisibilitychange"):void 0!==document.hidden&&(this.hidden="mshidden",this.visibilityChange="msvisibilitychange")},supportFullScreen:function(){this.$fullScreenRequest(),this.$fullScreenExit(),this.$fullScreenOnChange(),this.support.fullScreen=document.fullscreenEnabled||document.mozFullScreenEnabled||document.webkitFullscreenEnabled||document.msFullscreenEnabled},$fullScreenRequest:function(){var e=document.documentElement;void 0!==e.requestFullscreen?this.fullScreenRequest="requestFullscreen":void 0!==e.webkitRequestFullscreen?this.fullScreenRequest="webkitRequestFullscreen":void 0!==e.mozRequestFullScreen?this.fullScreenRequest="mozRequestFullScreen":void 0!==e.msRequestFullscreen&&(this.fullScreenRequest="msRequestFullscreen")},$fullScreenExit:function(){void 0!==document.exitFullscreen?this.fullScreenExit="exitFullscreen":void 0!==document.webkitExitFullscreen?this.fullScreenExit="webkitExitFullscreen":void 0!==document.mozCancelFullScreen?this.fullScreenExit="mozCancelFullScreen":void 0!==document.msExitFullscreen&&(this.fullScreenExit="msExitFullscreen")},$fullScreenOnChange:function(){void 0!==document.onfullscreenchange?this.fullScreenOnChange="fullscreenchange":void 0!==document.onwebkitfullscreenchange?this.fullScreenOnChange="webkitfullscreenchange":void 0!==document.onmozfullscreenchange?this.fullScreenOnChange="mozfullscreenchange":void 0!==document.onmsfullscreenchange&&(this.fullScreenOnChange="msfullscreenchange")},supportRequestAnimFrame:function(){window.requestAnimationFrame||(window.requestAnimationFrame=function(){return window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(e,t){window.setTimeout(e,1e3/60)}}())},supportPerformanceNow:function(){void 0===window.performance&&(window.performance={}),void 0===window.performance.now&&(window.performance.now=Date.now)},supportAudioFormats:function(){var e=document.createElement("audio");e.canPlayType("audio/mp4")&&this.audioFormats.push("m4a"),e.canPlayType("audio/ogg")&&this.audioFormats.push("ogg"),e.canPlayType("audio/mpeg")&&this.audioFormats.push("mp3"),e.canPlayType("audio/wav")&&this.audioFormats.push("wav")},supportAudioAPI:function(){window.AudioContext||(window.AudioContext=window.webkitAudioContext||window.mozAudioContext||window.oAudioContext||window.msAudioContext),window.AudioContext&&(this.audioAPI=!0)},supportFileSystemAPI:function(){window.requestFileSystem||(window.requestFileSystem=window.webkitRequestFileSystem||window.mozRequestFileSystem||window.oRequestFileSystem||window.msRequestFileSystem),window.requestFileSystem&&(this.support.fileSystemAPI=!0)},name:"unknown",version:"0",versionBuffer:null,vendors:["","webkit","moz","ms","o"],vendor:"",support:{},audioFormats:[],mobile:!1,isPortrait:!1,audioAPI:!1,hidden:null,visibilityChange:null,fullScreenRequest:null,fullScreenExit:null,fullScreenOnChange:null,fullscreen:!1},meta.device.load(),"use strict",meta.input={setup:function(){var e=this.$numKeys+this.$numInputs+1;this.keys=new Array(e),this.keybinds=new Array(e),this.$eventDown=new this.Event,this.$event=new this.Event,meta.on("blur",this.resetInputs,this),this.$loadIgnoreKeys(),this.$addEventListeners()},handleKeyDown:function(e){var t=e.keyCode;this.checkIgnoreKey(e,t),this.enable&&(this.stickyKeys&&this.keys[t]||(this.keys[t]=1,this.$eventDown.domEvent=e,this.$eventDown.prevScreenX=0,this.$eventDown.prevScreenY=0,this.$eventDown.screenX=0,this.$eventDown.screenY=0,this.$eventDown.x=0,this.$eventDown.y=0,this.$eventDown.keyCode=t,this.$eventDown.keybind=this.keybinds[t]||null,meta.emit("input.down",this.$eventDown),this.updateRepeatKey(t)))},handleKeyUp:function(e){var t=event.keyCode;this.checkIgnoreKey(e,t),this.enable&&(this.keys[t]=0,this.$event.domEvent=e,this.$event.prevScreenX=0,this.$event.prevScreenY=0,this.$event.screenX=0,this.$event.screenY=0,this.$event.x=0,this.$event.y=0,this.$event.keyCode=t,this.$event.keybind=this.keybinds[t]||null,meta.emit("input.up",this.$event),this.repeatKey&&this.$repeatTimer&&this.$repeatTimer.stop())},handleMouseDown:function(e){if(this.enable){var t=event.button+this.BUTTON_ENUM_OFFSET;this.keys[t]=1;var i=meta.engine,n=meta.camera;this.prevScreenX=this.screenX,this.prevScreenY=this.screenX,this.screenX=(event.pageX-i.offsetLeft)*i.scaleX*i.ratio,this.screenY=(event.pageY-i.offsetTop)*i.scaleY*i.ratio,this.x=this.screenX*n.zoomRatio+n.volume.x|0,this.y=this.screenY*n.zoomRatio+n.volume.y|0,this.$event.domEvent=e,this.$event.prevScreenX=this.prevScreenX,this.$event.prevScreenY=this.prevScreenY,this.$event.screenX=this.screenX,this.$event.screenY=this.screenY,this.$event.x=this.x,this.$event.y=this.y,this.$event.keyCode=t,this.$event.keybind=this.keybinds[t]||null,meta.emit("input.down",this.$event)}},handleMouseUp:function(e){if(this.enable){var t=event.button+this.BUTTON_ENUM_OFFSET;this.keys[t]=0;var i=meta.engine,n=meta.camera;this.prevScreenX=this.screenX,this.prevScreenY=this.screenY,this.screenX=(event.pageX-i.offsetLeft)*i.scaleX*i.ratio,this.screenY=(event.pageY-i.offsetTop)*i.scaleY*i.ratio,this.x=this.screenX*n.zoomRatio+n.volume.x|0,this.y=this.screenY*n.zoomRatio+n.volume.y|0,this.$event.domEvent=e,this.$event.prevScreenX=this.prevScreenX,this.$event.prevScreenY=this.prevScreenY,this.$event.screenX=this.screenX,this.$event.screenY=this.screenY,this.$event.x=this.x,this.$event.y=this.y,this.$event.keyCode=t,this.$event.keybind=this.keybinds[t]||null,meta.emit("input.up",this.$event)}},handleMouseMove:function(e){if(document.activeElement===document.body&&e.preventDefault(),this.enable){var t=meta.engine,i=meta.camera;this.prevScreenX=this.screenX,this.prevScreenY=this.screenY,this.screenX=(event.pageX-t.offsetLeft)*t.scaleX*t.ratio,this.screenY=(event.pageY-t.offsetTop)*t.scaleY*t.ratio,this.x=this.screenX*i.zoomRatio+i.volume.x|0,this.y=this.screenY*i.zoomRatio+i.volume.y|0,this.$event.domEvent=e,this.$event.prevScreenX=this.prevScreenX,this.$event.prevScreenY=this.prevScreenY,this.$event.screenX=this.screenX,this.$event.screenY=this.screenY,this.$event.x=this.x,this.$event.y=this.y,this.$event.keyCode=-1,meta.emit("input.move",this.$event)}},handleMouseDbClick:function(e){if(this.enable){var t=meta.engine,i=meta.camera,n=e.button;this.prevScreenX=this.screenX,this.prevScreenY=this.screenY,this.screenX=(event.pageX-t.offsetLeft)*t.scaleX*t.ratio,this.screenY=(event.pageY-t.offsetTop)*t.scaleY*t.ratio,this.x=this.screenX*i.zoomRatio+i.volume.x|0,this.y=this.screenY*i.zoomRatio+i.volume.y|0,this.$event.domEvent=e,this.$event.prevScreenX=this.prevScreenX,this.$event.prevScreenY=this.prevScreenY,this.$event.screenX=this.screenX,this.$event.screenY=this.screenY,this.$event.x=this.x,this.$event.y=this.y,this.$event.keyCode=n,this.$event.keybind=this.keybinds[n]||null,meta.emit("input.up",this.$event)}},handleTouchDown:function(e){document.activeElement===document.body&&e.preventDefault();for(var t=meta.engine,i=meta.camera,n=e.changedTouches,s=n.length,r=0;s>r;r++){var o=this.touches.length-1,a=n[r];this.touches.push(a.identifier);var h=(a.pageX-t.offsetLeft)*t.scaleX*t.ratio,c=(a.pageY-t.offsetTop)*t.scaleY*t.ratio,u=h*i.zoomRatio+i.volume.x|0,m=c*i.zoomRatio+i.volume.y|0,d=o+this.BUTTON_ENUM_OFFSET;this.keys[d]=1,this.$event.domEvent=e,this.$event.prevScreenX=h,this.$event.prevScreenY=c,this.$event.screenX=h,this.$event.screenY=c,this.$event.x=u,this.$event.y=m,this.$event.keyCode=d,this.$event.keybind=this.keybinds[d]||null,0===o&&(this.screenX=h,this.screenY=c,this.x=u,this.y=m),meta.emit("input.down",this.$event)}},handleTouchUp:function(e){document.activeElement===document.body&&e.preventDefault();for(var t=meta.engine,i=meta.camera,n=e.changedTouches,s=n.length,r=0;s>r;r++){var o=n[r],a=this.$getTouchID(o.identifier);if(-1!==a){this.touches.splice(a,1);var h=(o.pageX-t.offsetLeft)*t.scaleX*t.ratio,c=(o.pageY-t.offsetTop)*t.scaleY*t.ratio,u=h*i.zoomRatio+i.volume.x|0,m=c*i.zoomRatio+i.volume.y|0,d=a+this.BUTTON_ENUM_OFFSET;this.keys[d]=0,0===a?(this.prevScreenX=this.screenX,this.prevScreenY=this.screenY,this.screenX=h,this.screenY=c,this.x=u,this.y=m,this.$event.prevScreenX=this.prevScreenX,this.$event.prevScreenY=this.prevScreenY):(this.$event.prevScreenX=0,this.$event.prevScreenY=0),this.$event.domEvent=e,this.$event.screenX=h,this.$event.screenY=c,this.$event.x=u,this.$event.y=m,this.$event.keyCode=a,this.$event.keybind=this.keybinds[d]||null,meta.emit("input.down",this.$event)}}},handleTouchMove:function(e){document.activeElement===document.body&&e.preventDefault();for(var t=meta,i=t.camera,n=e.changedTouches,s=n.length,r=0;s>r;r++){var o=n[r],a=this.$getTouchID(o.identifier);if(-1!==a){var h=(o.pageX-engine.offsetLeft)*engine.scaleX*engine.ratio,c=(o.pageY-engine.offsetTop)*engine.scaleY*engine.ratio,u=h*i.zoomRatio+i.volume.x|0,m=c*i.zoomRatio+i.volume.y|0,d=a+this.BUTTON_ENUM_OFFSET;0===a?(this.prevScreenX=this.screenX,this.prevScreenY=this.screenY,this.screenX=h,this.screenY=c,this.x=u,this.y=m,this.$event.prevScreenX=this.prevScreenX,this.$event.prevScreenY=this.prevScreenY):(this.$event.prevScreenX=h,this.$event.prevScreenY=c),this.$event.domEvent=e,this.$event.screenX=0,this.$event.screenY=0,this.$event.x=u,this.$event.y=m,this.$event.keyCode=d,this.$event.keybind=this.keybinds[d]||null,meta.emit("input.move",$event)}}},$getTouchID:function(e){for(var t=0;t<this.touches.length;t++)if(this.touches[t]===e)return t;return-1},resetInputs:function(){this.$event.domEvent=null,this.$event.prevScreenX=this.prevScreenX,this.$event.prevScreenY=this.prevScreenY,this.$event.screenX=this.screenX,this.$event.screenY=this.screenY,this.$event.x=this.x,this.$event.y=this.y;for(var e=0;e<this.keys.length;e++)this.keys[e]&&(this.keys[e]=0,this.$event.keyCode=e,this.$event.keybind=this.$keybinds[e],meta.emit("input.up",this.$event));for(var e=0;e<this.touches.length;e++)if(this.touches[e]){var t=e+this.BUTTON_ENUM_OFFSET;this.$event.keyCode=t,this.$event.keybind=this.$keybinds[t]}this.$eventDown=new this.Event,this.$event=new this.Event},keybind:function(e,t){if(t instanceof Array)for(var i=0;i<t.length;i++){var n=t[i];this.keybinds[n]=e,this.keybindMap[e]=n}else this.keybinds[t]=e,this.keybindMap[e]=t},isDown:function(e){return this.keys[e]},isUp:function(e){return!this.keys[e]},isKeybindDown:function(e){return this.keys[this.keybindMap[e]]},isKeybindUp:function(e){return!this.keys[this.keybindMap[e]]},checkIgnoreKey:function(e,t){document.activeElement===document.body&&(window.top&&this.iframeKeys[t]&&e.preventDefault(),void 0!==this.cmdKeys[t]&&this.numCmdKeysPressed++,void 0!==this.ignoreKeys[t]&&this.numCmdKeysPressed<=0&&e.preventDefault())},updateRepeatKey:function(e){this.repeatKey&&(this.$repeatTimer||(this.$repeatTimer=meta.addTimer(this,this.repeatFunc,this.repeatDelay)),this.repeatKey=e,this.$repeatTimer.reset())},repeatFunc:function(){this.$eventDown.domEvent=domEvent,this.$eventDown.prevScreenX=0,this.$eventDown.prevScreenY=0,this.$eventDown.screenX=0,this.$eventDown.screenY=0,this.$eventDown.x=0,this.$eventDown.y=0,this.$eventDown.keyCode=keyCode,this.$eventDown.keybind=this.keybinds[keyCode]||null,meta.emit("input.down",$this.eventDown)},$addEventListeners:function(){var e=this;window.addEventListener("mousedown",function(t){e.handleMouseDown(t)}),window.addEventListener("mouseup",function(t){e.handleMouseUp(t)}),window.addEventListener("mousemove",function(t){e.handleMouseMove(t)}),window.addEventListener("dblclick",function(t){e.handleMouseDbClick(t)}),window.addEventListener("touchstart",function(t){e.handleTouchDown(t)}),window.addEventListener("touchend",function(t){e.handleTouchUp(t)}),window.addEventListener("touchmove",function(t){e.handleTouchMove(t)}),window.addEventListener("touchcancel",function(t){e.handleTouchUp(t)}),window.addEventListener("touchleave",function(t){e.handleTouchUp(t)}),meta.device.support.onkeydown&&window.addEventListener("keydown",function(t){e.handleKeyDown(t)}),meta.device.support.onkeyup&&window.addEventListener("keyup",function(t){e.handleKeyUp(t)})},$loadIgnoreKeys:function(){this.ignoreKeys={},this.ignoreKeys[8]=1,this.ignoreKeys[9]=1,this.ignoreKeys[13]=1,this.ignoreKeys[17]=1,this.ignoreKeys[91]=1,this.ignoreKeys[38]=1,this.ignoreKeys[39]=1,this.ignoreKeys[40]=1,this.ignoreKeys[37]=1,this.ignoreKeys[124]=1,this.ignoreKeys[125]=1,this.ignoreKeys[126]=1,this.cmdKeys[91]=1,this.cmdKeys[17]=1,this.iframeKeys[37]=1,this.iframeKeys[38]=1,this.iframeKeys[39]=1,this.iframeKeys[40]=1},ignoreFKeys:function(e){this.ignoreKeys[112]=e,this.ignoreKeys[113]=e,this.ignoreKeys[114]=e,this.ignoreKeys[115]=e,this.ignoreKeys[116]=e,this.ignoreKeys[117]=e,this.ignoreKeys[118]=e,this.ignoreKeys[119]=e,this.ignoreKeys[120]=e,this.ignoreKeys[121]=e,this.ignoreKeys[122]=e,this.ignoreKeys[123]=e},set ignoreFKeys(e){e?this.$ignoreFKeys(1):this.$ignoreFKeys(0)},get ignoreFKeys(){return!!this.$ignoreKeys[112]},Event:function(){this.domEvent=null,this.x=0,this.y=0,this.prevScreenX=0,this.prevScreenY=0,this.screenX=0,this.screenY=0,this.keyCode=0,this.keybind=null,this.entity=null},keys:null,keybinds:null,touches:[],keybindMap:{},ignoreKeys:{},cmdKeys:{},iframeKeys:{},enable:!0,stickyKeys:!1,numCmdKeysPressed:0,$repeatTimer:null,repeatKey:!1,repeatDelay:200,x:0,y:0,screenX:0,screenY:0,prevScreenX:0,prevScreenY:0,$numKeys:256,$numInputs:10,BUTTON_ENUM_OFFSET:2e3},meta.input.key={BACKSPACE:8,TAB:9,ENTER:13,SHIFT:16,ESC:27,SPACE:32,LEFT:37,UP:38,RIGHT:39,DOWN:40,DELETE:46,NUM_0:48,NUM_1:49,NUM_2:50,NUM_3:51,NUM_4:52,NUM_5:53,NUM_6:54,NUM_7:55,NUM_8:56,NUM_9:57,NUMPAD_0:96,NUMPAD_1:97,NUMPAD_2:98,NUMPAD_3:99,NUMPAD_4:100,NUMPAD_5:101,NUMPAD_6:102,NUMPAD_7:103,NUMPAD_8:104,NUMPAD_9:105,MULTIPLY:106,ADD:107,SUBTRACT:109,DECIMAL:110,DIVIDE:111,A:65,B:66,C:67,D:68,E:69,F:70,G:71,H:72,I:73,J:74,K:75,L:76,M:77,N:78,O:79,P:80,Q:81,R:82,S:83,T:84,U:85,V:86,W:87,X:88,Y:89,Z:90,SQUARE_BRACKET_LEFT:91,SQUARE_BRACKET_RIGHT:91,PARENTHESES_LEFT:91,PARENTHESES_RIGHT:91,BRACES_LEFT:91,BRACES_RIGHT:92,F1:112,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F8:119,F9:120,F10:121,F11:122,F12:123,PLUS:187,MINUS:189,TILDE:192,APOSTROPHE:222,BUTTON_LEFT:0+meta.input.BUTTON_ENUM_OFFSET,BUTTON_MIDDLE:1+meta.input.BUTTON_ENUM_OFFSET,BUTTON_RIGHT:2+meta.input.BUTTON_ENUM_OFFSET},meta.input.setup(),"use strict",meta.pools={},meta.new=function(e,t){if(!e)return console.warn("(meta.new) Invalid class passed with params:",t),void 0;var i=meta.pools[e.prototype.__name__];i||(i=[],meta.pools[e.prototype.__name__]=i);var n=i.pop();return n?n.create(t):n=new e(t),n},meta.delete=function(e){e.remove(),buffer.push(e)},"use strict",meta.View=function(e){this.name=e,this.flags=0,this.entities=[],this.children=[],this.$position=new meta.math.Vector2(0,0),this.$z=0},meta.View.prototype={add:function(e){return e.flags&this.Flag.REMOVED?(console.warn("(meta.View.add) Trying to add entity that has been removed"),void 0):e.$view?(e.$view===this?console.warn("(meta.View.add) Entity is already added to this view"):console.warn("(meta.View.add) Entity is already added to some other view"),void 0):(e.flags|=e.Flag.ROOT,e.$view=this,(0!==this.$position.x||0!==this.$position.y)&&e.updatePosition(),0!==this.$z&&e.updateZ(),this.entities.push(e),this.$addChildren(e.children),this.flags&this.Flag.ACTIVE&&!(this.flags&this.Flag.INSTANCE_HIDDEN)&&meta.renderer.addEntity(e,!1),void 0)},$addChildren:function(e){},remove:function(e){},$activate:function(){if(this.flags|=this.Flag.ACTIVE,!(this.flags&this.Flag.INSTANCE_HIDDEN)&&(meta.renderer.addEntities(this.entities),this.children))for(var e=this.children.length,t=0;e>t;t++)this.children[t].$activate()},$deactivate:function(){if(this.flags&=~this.Flag.ACTIVE,!(this.flags&this.Flag.INSTANCE_HIDDEN)&&(meta.renderer.removeEntities(this.entities),this.children))for(var e=this.children.length,t=0;e>t;t++)this.children[t].$deactivate()},get active(){return(this.flags&this.Flag.ACTIVE)===this.Flag.ACTIVE},Flag:{HIDDEN:1,INSTANCE_HIDDEN:2,ACTIVE:4,STATIC:8,DEBUGGER:16}},"use strict",meta.Camera=function(e,t,i,n){this.volume=new meta.math.AABB(0,0,0,0),this.create()},meta.Camera.prototype={create:function(e,t,i,n){this.volume.set(e,t,i,n)},remove:function(){},activate:function(){},update:function(){this.emit("camera-move",this)},updateZoom:function(){},onResize:function(){this.volume.resize(meta.engine.width,meta.engine.height)},volume:null,$zoom:1,zoomPrev:1,zoomRatio:1,$zoomAuto:!1},meta.math={epsilon:1e-6,nearestPowerOfTwo:function(e){return Math.pow(2,Math.round(Math.log(e)/Math.LN2))},upperPowerOfTwo:function(e){return e--,e|=e>>1,e|=e>>2,e|=e>>4,e|=e>>8,e|=e>>16,e++,e}},"use strict",meta.math.Vector2=function(e,t){this.x=e||0,this.y=t||0},meta.math.Vector2.prototype={set:function(e,t){this.x=e,this.y=t},clone:function(){return new meta.math.Vector2(this.x,this.y)},copy:function(e){this.x=e.x,this.y=e.y},add:function(e){this.x+=e.x,this.y+=e.y},sub:function(e){this.x-=e.x,this.y-=e.y},mul:function(e){this.x*=e.x,this.y*=e.y},div:function(e){this.x/=e.x,this.y/=e.y},scale:function(e,t){this.x*=e,this.Y*=t},floor:function(){this.x=Math.floor(this.x),this.y=Math.floor(this.y)},ceil:function(){this.x=Math.ceil(this.x),this.y=Math.ceil(this.y)},round:function(){this.x=Math.round(this.x),this.y=Math.round(this.y)},min:function(e,t){this.x=Math.min(this.x,e),this.y=Math.min(this.y,t)},max:function(e,t){this.x=Math.max(this.x,e),this.y=Math.max(this.y,t)},length:function(e){var t=this.x-e.x,i=this.y-e.y;return t*t+i*i},squaredLength:function(e){return this.x*this.x+this.y*this.y},inverse:function(){this.x=1/this.x,this.y=1/this.y},magnitude:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},normalize:function(){var e=this.x*this.x+this.y*this.y;e>0?(this.x=0,this.y=0):(e=Math.sqrt(e),this.x/=e,this.y/=e)},dot:function(e){return this.x*e.x+this.y*e.y},lerp:function(e,t,i){this.x=e.x+i*(t.x-e.x),this.y=e.y+i*(t.y-e.y)},rand:function(e,t){this.x=meta.random.number(e,t),this.y=meta.random.number(e,t)},exactEquals:function(e){return this.x===e.x&&this.y===e.y?!0:!1},equals:function(e){return Math.abs(this.x-e.x)<=meta.math.epsilon*Math.max(1,Math.abs(this.x),Math.abs(e.x))&&Math.abs(this.y-e.y)<=meta.math.epsilon*Math.max(1,Math.abs(this.y),Math.abs(e.y))},getNormalized:function(){var e=Math.sqrt(this.x*this.x+this.y*this.y);return 0===e?new meta.math.vector2(0,0):new meta.math.vector2(this.x/e,this.y/e);
},getAngle:function(){return 180*Math.atan2(this.y,this.x)/Math.PI},toString:function(){return"x:"+this.x+" y:"+this.y}},"use strict",meta.math.AABB=function(e,t,i,n){this.set(e,t,i,n)},meta.math.AABB.prototype={set:function(e,t,i,n){this.x=e||0,this.y=t||0,this.width=i||i,this.height=n||n},resize:function(e,t){this.width=e,this.height=t}},"use strict",meta.math.Matrix4=function(e){e?e instanceof Float32Array?this.m=new Float32Array(e):e instanceof meta.math.Matrix4&&(this.m=new Float32Array(e.m)):this.create()},meta.math.Matrix4.prototype={create:function(){this.m=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])},clone:function(){return new meta.math.Matrix4(this.m)},copy:function(e){this.m.set(e.m)},set:function(e,t,i,n,s,r,o,a,h,c,u,m,d,l,f,v){this.m[0]=e,this.m[1]=t,this.m[2]=i,this.m[3]=n,this.m[4]=s,this.m[5]=r,this.m[6]=o,this.m[7]=a,this.m[8]=h,this.m[9]=c,this.m[10]=u,this.m[11]=m,this.m[12]=d,this.m[13]=l,this.m[14]=f,this.m[15]=v},identity:function(){this.m[0]=1,this.m[1]=0,this.m[2]=0,this.m[3]=0,this.m[4]=0,this.m[5]=1,this.m[6]=0,this.m[7]=0,this.m[8]=0,this.m[9]=0,this.m[10]=1,this.m[11]=0,this.m[12]=0,this.m[13]=0,this.m[14]=0,this.m[15]=1},transpose:function(){var e=this.m[1],t=this.m[2],i=this.m[3],n=this.m[6],s=this.m[7],r=this.m[11];this.m[1]=this.m[4],this.m[2]=this.m[8],this.m[3]=this.m[12],this.m[4]=e,this.m[6]=this.m[9],this.m[7]=this.m[13],this.m[8]=t,this.m[9]=n,this.m[11]=this.m[14],this.m[12]=i,this.m[13]=s,this.m[14]=r},translate:function(e,t,i){this.m[12]+=this.m[0]*e+this.m[4]*t+this.m[8]*i,this.m[13]+=this.m[1]*e+this.m[5]*t+this.m[9]*i,this.m[14]+=this.m[2]*e+this.m[6]*t+this.m[10]*i,this.m[15]+=this.m[3]*e+this.m[7]*t+this.m[11]*i},scale:function(e,t,i){this.m[0]*=e,this.m[1]*=e,this.m[2]*=e,this.m[3]*=e,this.m[4]*=t,this.m[5]*=t,this.m[6]*=t,this.m[7]*=t,this.m[8]*=i,this.m[9]*=i,this.m[10]*=i,this.m[11]*=i},ortho:function(e,t,i,n,s,r){var o=1/(e-t),a=1/(i-n),h=1/(s-r);this.m[0]=-2*o,this.m[1]=0,this.m[2]=0,this.m[3]=0,this.m[4]=0,this.m[5]=-2*a,this.m[6]=0,this.m[7]=0,this.m[8]=0,this.m[9]=0,this.m[10]=2*h,this.m[11]=0,this.m[12]=(e+t)*o,this.m[13]=(n+i)*a,this.m[14]=(r+s)*h,this.m[15]=1},perspective:function(e,t,i,n){var s=1/Math.tan(e/2),r=1/(i-n);this.m[0]=s/t,this.m[1]=0,this.m[2]=0,this.m[3]=0,this.m[4]=0,this.m[5]=s,this.m[6]=0,this.m[7]=0,this.m[8]=0,this.m[9]=0,this.m[10]=(n+i)*r,this.m[11]=-1,this.m[12]=0,this.m[13]=0,this.m[14]=2*n*i*r,this.m[15]=0},frustum:function(e,t,i,n,s,r){var o=1/(t-e),a=1/(n-i),h=1/(s-r);this.m[0]=2*s*o,this.m[1]=0,this.m[2]=0,this.m[3]=0,this.m[4]=0,this.m[5]=2*s*a,this.m[6]=0,this.m[7]=0,this.m[8]=(t+e)*o,this.m[9]=(n+i)*a,this.m[10]=(r+s)*h,this.m[11]=-1,this.m[12]=0,this.m[13]=0,this.m[14]=r*s*2*h,this.m[15]=0},fromTransformation:function(e,t,i){this.m[0]=1,this.m[1]=0,this.m[2]=0,this.m[3]=0,this.m[4]=0,this.m[5]=1,this.m[6]=0,this.m[7]=0,this.m[8]=0,this.m[9]=0,this.m[10]=1,this.m[11]=0,this.m[12]=e,this.m[13]=t,this.m[14]=i,this.m[15]=1},toString:function(){return"["+this.m[0]+", "+this.m[1]+", "+this.m[2]+", "+this.m[3]+this.m[4]+", "+this.m[5]+", "+this.m[6]+", "+this.m[7]+this.m[8]+", "+this.m[9]+", "+this.m[10]+", "+this.m[11]+this.m[12]+", "+this.m[13]+", "+this.m[14]+", "+this.m[15]+"]"}},"use strict",meta.math.Random=function(){this.seed=0,this.a=0,this.m=0,this.q=0,this.r=0,this.oneOverM=0,this.init()},meta.math.Random.prototype={init:function(){this.setSeed(Date.now(),!0)},generate:function(){var e=Math.floor(this.seed/this.q),t=this.seed%this.q,i=this.a*t-this.r*e;return i>0?this.seed=i:this.seed=i+this.m,this.seed*this.oneOverM},number:function(e,t){var i=this.generate();return Math.round((t-e)*i+e)},numberF:function(e,t){var i=this.generate();return(t-e)*i+e},setSeed:function(e,t){if(void 0!==t&&(t=!0),t===!0){var i=new Date;this.seed=e+16777215*i.getSeconds()+65535*i.getMinutes()}else this.seed=e;this.a=48271,this.m=2147483647,this.q=Math.floor(this.m/this.a),this.r=this.m%this.a,this.oneOverM=1/this.m}},meta.random=new meta.math.Random,"use strict";var vertices=[0,0,200,0,200,200,0,200],indices=[0,1,2,0,2,3],uvCoords=[0,0,1,0,1,1,0,1],vbo=null,uv,indiceBuffer;meta.renderer={setup:function(){var e=meta.engine.gl;this.gl=e,this.bgColor="#000000FF",vbo=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,vbo),e.bufferData(e.ARRAY_BUFFER,new Float32Array(vertices),e.STATIC_DRAW),uv=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,uv),e.bufferData(e.ARRAY_BUFFER,new Float32Array(uvCoords),e.STATIC_DRAW),indiceBuffer=e.createBuffer(),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,indiceBuffer),e.bufferData(e.ELEMENT_ARRAY_BUFFER,new Uint16Array(indices),e.STATIC_DRAW),e.activeTexture(e.TEXTURE0)},render:function(){var e=this.gl;e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT);var t=new meta.math.Matrix4;t.ortho(0,meta.engine.width,meta.engine.height,0,0,1),e.uniformMatrix4fv(this.currShader.uniform.projMatrix,!1,t.m),e.uniform1i(this.currShader.uniform.texture,0),e.bindBuffer(e.ARRAY_BUFFER,vbo),e.vertexAttribPointer(this.currShader.attrib.vertexPos,2,e.FLOAT,!1,0,0),e.bindBuffer(e.ARRAY_BUFFER,uv),e.vertexAttribPointer(this.currShader.attrib.uvCoords,2,e.FLOAT,!1,0,0),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,indiceBuffer);for(var i=0;i<this.entities.length;i++){var n=this.entities[i];if(!n.texture)return;if(!n.texture.loaded)return;e.bindTexture(e.TEXTURE_2D,n.texture.instance);var s=new meta.math.Matrix4;s.translate(n.$x,n.$y,0),e.uniformMatrix4fv(this.currShader.uniform.modelViewMatrix,!1,s.m),e.drawElements(e.TRIANGLES,6,e.UNSIGNED_SHORT,0)}},onResize:function(){this.gl.viewport(0,0,meta.engine.width,meta.engine.height)},addEntities:function(e){for(var t=0;t<e.length;t++)this.addEntity(e[t])},removeEntities:function(e){for(var t=0;t<e.length;t++)this.removeEntity(e[t])},addEntity:function(e){this.entities.push(e)},removeEntity:function(e){},set bgColor(e){if(this.$bgColor!==e){7===e.length&&(e+="FF"),this.$bgColor=e;var t=parseInt(e.slice(1),16),i=(t>>24)/255,n=(t>>16&255)/255,s=(t>>8&255)/255,r=(255&t)/255;this.gl.clearColor(i,n,s,r)}},get color(){this.$bgColor},entities:[],entitiesRemove:[],$bgColor:null,currShader:null},"use strict",meta.renderer.SpriteBatch=function(){},meta.renderer.SpriteBatch.prototype={create:function(){},capacity:100},"use strict",meta.resources={add:function(e,t){var i=this.table[e];i?i.push(t):(i=[t],this.table[e]=i)},remove:function(e,t){var i=this.table[e];if(!i)return console.warn("(meta.resources.remove) No resources with such type added: "+e),void 0;var n=i.indexOf(t);return-1===n?(console.warn("(meta.resources.remove) No resources with such type added: "+e),void 0):(i[n]=i[i.lenght-1],i.pop(),void 0)},addResource:function(e){if(!e)return console.warn("(meta.resources.addResource) Invalid resource passed"),void 0;if(!e.type)return console.warn("(meta.resources.addResource) Invalid resource type"),void 0;var t=this.table[type];return t||(t={},this.table[type]=t),t[e.id]?(console.warn("(meta.resources.loadResource) There is already resource with id: "+id+", and type: "+type),void 0):(t[e.id]=e,void 0)},removeResource:function(e,t){if(!e)return console.warn("(meta.resources.removeResource) Invalid resource passed"),void 0;if(0===(e.flags&e.Flag.MANAGED))return console.warn("(meta.resources.removeResource) Resource not managed by resource manager"),void 0;if(!e.type)return console.warn("(meta.resources.removeResource) Invalid resource type"),void 0;var i=this.table[type];return i&&i[id]?(void 0===t&&(t=!0),i[id]=null,e.remove(),void 0):(console.warn("(meta.resources.removeResource) No such resource found:",e.id),void 0)},loadResource:function(e,t,i){var n=this.table[e];n||(n={},this.table[e]=n);var s=meta.new(t,i);return s.id?n[s.id]?(meta.delete(s),console.warn("(meta.resources.loadResource) There is already resource with id: "+id+", and type: "+e),null):(n[s.id]=s,s):(meta.delete(s),console.warn("(meta.resources.loadResource) Created resource with invalid ID from params: ",i),null)},getResource:function(e,t){var i=this.table[e];if(!i)return console.warn("(meta.resources.getResource) No resources found for type: "+e),void 0;var n=i[t];return n?n:(console.warn("(meta.resources.getResource) There is no resource with id: "+t+", and type: "+e),void 0)},loadShader:function(e,t){return this.loadResource("shader",meta.Shader,e,t)},getShader:function(e){return this.getResource("shader",e)},loadTexture:function(e,t){return this.loadResource("texture",meta.Texture,e,t)},getTexture:function(e){return this.getResource("texture",e)},loadVideo:function(e,t){return this.loadResource("video",meta.Video,e,t)},getVideo:function(e){return this.getResource("video",e)},table:{texture:{},shader:{},audio:{},atlas:{},video:{}}},"use strict",meta.class("meta.Resource",{init:function(e){this.create(e||null)},create:function(e){e?(this.loadParams(e),this.load(e)):this.load(null)},loadParams:function(e){if("object"==typeof e)for(var t in e)this[t]=e[t]},watch:function(e,t){var i=new meta.Watcher(e,t);this.watchers?this.watchers.push(i):this.watchers=[i]},unwatch:function(e){for(var t=this.watchers.length,i=0;t>i;i++)if(this.watchers[i].owner===e){this.watchers[i]=this.watchers[t-1],this.watchers.pop();break}},emit:function(e){if(this.watchers)for(var t=0;t<this.watchers.length;t++){var i=this.watchers[t];i.func.call(i.owner,e)}},get loaded(){return(this.flags&this.Flag.LOADED)===this.Flag.LOADED},Flag:{LOADED:1,ADDED:2},id:null,type:null,watchers:null,flags:0}),"use strict",meta.class("meta.Texture","meta.Resource",{onRemove:function(){this.emit("removed"),meta.engine.gl.deleteTexture(this.instance),this.instance=null,this.image=null,this.width=0,this.height=0},load:function(e){if(e){var t;if("string"==typeof e)t=e,this.id=meta.getNameFromPath(e);else{if(!e.path)return;t=e.path,this.id=e.id||meta.getNameFromPath(t)}if(this.ext=meta.getExtFromPath(e),this.ext?this.$path=e:(this.ext="png",this.$path=e+".png"),!this.instance){var i=this;this.instance=meta.engine.gl.createTexture(),this.image=new Image,this.image.onload=function(){i.onLoad()}}this.image.src=t}},onLoad:function(){if(this.instance){this.width=this.image.width,this.height=this.image.height;var e=meta.engine.gl;e.bindTexture(e.TEXTURE_2D,this.instance),this.isPowTwo()?(e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,this.image),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR_MIPMAP_NEAREST),e.generateMipmap(e.TEXTURE_2D)):meta.flags.autoPowTwo?(this.resizePowTwo(),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,this.image),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR_MIPMAP_NEAREST),e.generateMipmap(e.TEXTURE_2D)):(e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,this.image),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE));var t=meta.getExt("EXT_texture_filter_anisotropic");t&&e.texParameterf(e.TEXTURE_2D,t.TEXTURE_MAX_ANISOTROPY_EXT,meta.getExtParam(t.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),e.bindTexture(e.TEXTURE_2D,null),this.flags|=this.Flag.LOADED,this.emit("loaded")}},resizePowTwo:function(){var e=document.createElement("canvas");e.width=meta.math.nearestPowerOfTwo(this.width),e.height=meta.math.nearestPowerOfTwo(this.height);var t=e.getContext("2d");t.drawImage(this.image,0,0,e.width,e.height),console.warn("(meta.Texture.resizePowTwo) Resized image["+this.id+"] from ("+this.width+"x"+this.height+") to ("+e.width+"x"+e.height+")"),this.width=e.width,this.height=e.height,this.image=e},isPowTwo:function(){var e=0!=this.width&&(this.width&~this.width+1)===this.width;if(!e)return!1;var t=0!=this.height&&(this.height&~this.height+1)===this.height;return t?!0:!1},type:"texture",instance:null,image:null,width:0,height:0,path:null}),"use strict",meta.class("meta.Video","meta.Resource",{onCanPlay:function(){},onEnd:function(){},set path(e){if(this.$path!==e){if(this.$path=e,!this.videoElement){var t=this;this.videoElement=document.createElement("video"),this.videoElement.preload="auto",this.videoElement.oncanplaythrough=function(){t.onCanPlay()},this.videoElement.onended=function(){t.onEnd()}}this.videoElement.src=e}},get path(){return this.$path},type:"video",$path:null,videoElement:null}),"use strict",meta.class("meta.Shader","meta.Resource",{create:function(e){this.loadParams(e),this.compile()},compile:function(){if(this.$vertexShader&&this.$fragmentShader){var e=meta.engine.gl;if(this.program=e.createProgram(),e.attachShader(this.program,this.$vertexShader),e.attachShader(this.program,this.$fragmentShader),e.linkProgram(this.program),!e.getProgramParameter(this.program,e.LINK_STATUS))return console.warn("(meta.Shader.compile) Shader program failed to link: "+e.getShaderInfoLog(this.program)),e.deleteProgram(this.program),e.deleteShader(this.$vertexShader),e.deleteShader(this.$fragmentShader),this.program=null,this.$vertexShader=null,this.$fragmentShader=null,void 0;this.loadAttribs(),this.loadUniforms()}},use:function(){meta.engine.gl.useProgram(this.program),meta.renderer.currShader=this},loadAttribs:function(){this.attrib={};for(var e=meta.engine.gl,t=e.getProgramParameter(this.program,e.ACTIVE_ATTRIBUTES),i=0;t>i;i++){var n=e.getActiveAttrib(this.program,i),s=e.getAttribLocation(this.program,n.name);e.enableVertexAttribArray(s),this.attrib[n.name]=s}},loadUniforms:function(){this.uniform={};for(var e=meta.engine.gl,t=e.getProgramParameter(this.program,e.ACTIVE_UNIFORMS),i=0;t>i;i++){var n=e.getActiveUniform(this.program,i),s=n.name.replace("[0]","");this.uniform[s]=e.getUniformLocation(this.program,s)}},set vertexShader(e){var t=meta.engine.gl;return this.$vertexShader||(this.$vertexShader=t.createShader(t.VERTEX_SHADER)),e instanceof Array&&(e=e.join("\n")),t.shaderSource(this.$vertexShader,e),t.compileShader(this.$vertexShader),t.getShaderParameter(this.$vertexShader,t.COMPILE_STATUS)?void 0:(console.warn("(meta.Shader.vertexShader) ["+this.id+"]: "+t.getShaderInfoLog(this.$vertexShader)),t.deleteShader(this.$vertexShader),this.$vertexShader=null,void 0)},get vertexShader(){return this.$vertexShader},set fragmentShader(e){var t=meta.engine.gl;return this.$fragmentShader||(this.$fragmentShader=t.createShader(t.FRAGMENT_SHADER)),e instanceof Array&&(e=e.join("\n")),t.shaderSource(this.$fragmentShader,e),t.compileShader(this.$fragmentShader),t.getShaderParameter(this.$fragmentShader,t.COMPILE_STATUS)?void 0:(console.warn("(meta.Shader.fragmentShader) ["+this.id+"]: "+t.getShaderInfoLog(this.$fragmentShader)),t.deleteShader(this.$fragmentShader),this.$fragmentShader=null,void 0)},get fragmentShader(){return this.$fragmentShader},type:"shader",attributre:null,uniform:null,$vertexShader:null,$fragmentShader:null}),"use strict",meta.class("meta.Sprite",{init:function(e){this.$volume=new meta.math.AABB(0,0,0,0),this.create(e)},create:function(e){this.loadParams(e)},remove:function(){this.$x=this.$y=this.$z=0},loadParams:function(e){if(e)if("string"==typeof e)this.texture=e;else if(e instanceof meta.Texture)this.texture=e;else for(var t in e)this[t]=e[t]},position:function(e,t){this.$x=0,this.$y=0,this.updatePosition()},move:function(e,t){this.$x+=e,this.$y+=t,this.updatePosition()},updatePosition:function(){},updateZ:function(){},set x(e){this.$x=e,this.updatePosition()},set y(e){this.$y=e,this.updatePosition()},set z(e){this.$z=e,this.updateZ()},get x(){return this.$x},get y(){return this.$y},get z(){return this.$z},anchor:function(e,t){},pivot:function(e,t){},onClick:null,onPress:null,set texture(e){if("string"==typeof e&&(e=meta.resources.getTexture(e)),this.$texture){if(this.$texture.id===e.id)return;this.$texture.unwatch(this)}this.$texture=e,this.$texture&&this.$texture.watch(this.handleTexture,this)},get texture(){return this.$texture},handleTexture:function(e){("loaded"===e||"updated"===e)&&this.$volume.resize(this.$texture.width,this.$texture.height),console.log("event",e)},set shader(e){if("string"==typeof shader&&(shader=meta.resources.getShader(shader)),this.$shader){if(this.$shader.id===shader.id)return;this.$shader.unwatch(this)}this.$shader=shader,this.$shader&&this.$shader.watch(this.handleShader,this)},get shader(){return this.$shader},handleShader:function(e,t){},Flag:{REMOVED:1,INSTANCE_ENABLED:2,INSTANCE_VISIBLE:4,ROOT:8},$view:null,parent:null,$volume:null,flags:0,$x:0,$y:0,$z:0,$angle:null,$texture:null,$shader:null,anchorX:0,anchorY:0,pivotX:0,pivotY:0}),"use strict",meta.class("meta.Text","meta.Sprite",{}),"use strict",meta.class("meta.Particle",{}),"use strict",meta.on("domload",function(){meta.engine.init()}),DomLoad();